# History Microservice Help

## Содержание
- [Описание модуля](#описание-модуля)
- [Функциональные возможности](#функциональные-возможности)
- [Архитектура](#архитектура)
    - [Сущности (Entities)](#сущности-entities)
    - [DTO (Data Transfer Objects)](#dto-data-transfer-objects)
    - [Репозитории (Repositories)](#репозитории-repositories)
    - [Сервисный слой (Services)](#сервисный-слой-services)
    - [Мапперы (Mappers)](#мапперы-mappers)
    - [Контроллер (Controller)](#контроллер-controller)
    - [Конфигурация](#конфигурация)
- [Основные API-сценарии](#основные-api-сценарии)
    - [Агрегация данных из всех микросервисов](#1-агрегация-данных-из-всех-микросервисов)
    - [Получение истории изменений по конкретному микросервису](#2-получение-истории-изменений-по-конкретному-микросервису)
- [Технологический стек](#технологический-стек)
- [Обработка ошибок (Exception Handling)](#обработка-ошибок-exception-handling)
- [Безопасность](#безопасность)
- [Логирование и мониторинг](#логирование-и-мониторинг)
- [Развертывание](#развертывание)
- [Дополнительные требования](#дополнительные-требования)

## Описание модуля
History Microservice предназначен для хранения и агрегации истории изменений, полученной из других микросервисов. Он собирает данные из таблиц `audit` всех микросервисов, обрабатывает их и предоставляет возможность получения агрегированных или индивидуальных данных по запросу.

## Функциональные возможности
- REST API для работы с историей изменений.
- Агрегация данных из всех микросервисов с аудитом (`account`, `authorization`, `anti_fraud`, `profile`, `transfer`, `public_bank_info`).
- Возможность получения истории изменений по конкретному микросервису.
- Интеграция с PostgreSQL.
- JWT-аутентификация.
- Автоматическая генерация документации (Swagger/OpenAPI).

## Архитектура
### Сущности (Entities)
- `History` – хранит технические идентификаторы аудит-записей из всех микросервисов.

### DTO (Data Transfer Objects)
- `HistoryDto` – передача данных истории через API.

### Репозитории (Repositories)
- `HistoryRepository` – управление данными истории.

### Сервисный слой (Services)
- `HistoryService` – интерфейс для управления историей изменений.
- `HistoryServiceImpl` – реализация логики агрегации и получения данных.

### Мапперы (Mappers)
- `HistoryMapper` – преобразует сущности истории в DTO и обратно. Использует **MapStruct** и работает под управлением Spring (`@Mapper(componentModel = "spring")`).

### Контроллер (Controller)
- `HistoryController` – REST API для получения истории изменений.

### Конфигурация
- `SwaggerConfig` – настройка Swagger.

## Основные API-сценарии
### 1. Агрегация данных из всех микросервисов
- **GET** `/history/aggregate`
- Собирает и возвращает агрегированные данные истории изменений из всех микросервисов.

### 2. Получение истории изменений по конкретному микросервису
- **GET** `/history/{microservice}`
- Возвращает историю изменений по указанному микросервису (например, `authorization`, `account`, `anti_fraud`).

## Технологический стек
- Java 17
- Spring Boot 3.x
- Spring Data JPA
- PostgreSQL
- Lombok
- MapStruct
- Spring Security (JWT)
- Swagger/OpenAPI
- Logback (Slf4j)

## Обработка ошибок (Exception Handling)
- `GlobalExceptionHandler` – глобальный обработчик исключений для API.
- Обрабатывает `EntityNotFoundException`, `ValidationException` и другие стандартные ошибки.
- Возвращает структурированные ответы с кодами ошибок.

## Безопасность
- API защищено JWT-аутентификацией.
- Логируются запросы на получение истории.

## Логирование и мониторинг
- Используется `Slf4j` для логирования операций.
- Детализированные сообщения об ошибках.
- Логирование успешных и неуспешных операций.

## Развертывание
- Контейнеризация через Docker.
- Kubernetes (Helm Charts).
- Конфигурация через `application.yml`.

## Дополнительные требования
- Код соответствует принципам SOLID.
- Предусмотрены unit- и интеграционные тесты.
- Готовность к CI/CD (GitLab CI/GitHub Actions).

---
