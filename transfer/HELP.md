### **Transfer Microservice - Техническое Задание**

## **Содержание**

- [Описание модуля](#описание-модуля)
- [Функциональные возможности](#функциональные-возможности)
- [Архитектура](#архитектура)
    - [Сущности (Entities)](#сущности-entities)
    - [DTO (Data Transfer Objects)](#dto-data-transfer-objects)
    - [Репозитории (Repositories)](#репозитории-repositories)
    - [Сервисный слой (Services)](#сервисный-слой-services)
    - [AOP для аудита](#aop-для-аудита)
    - [Контроллеры (Controllers)](#контроллеры-controllers)
- [Основные API-сценарии](#основные-api-сценарии)
- [Технологический стек](#технологический-стек)
- [Обработка ошибок (Exception Handling)](#обработка-ошибок-exception-handling)
- [Безопасность](#безопасность)
- [Логирование и мониторинг](#логирование-и-мониторинг)
- [Развертывание](#развертывание)
- [Дополнительные требования](#дополнительные-требования)

---

## **Описание модуля**

Transfer Microservice предназначен для обработки переводов (по номеру счета, карты, телефона) и автоматического ведения истории изменений через AOP.\
**Аудит записывается автоматически** при выполнении операций.

## **Функциональные возможности**

- REST API для переводов.
- Автоматический аудит через AOP.
- Интеграция с PostgreSQL.
- JWT-аутентификация.
- Автоматическая документация (Swagger/OpenAPI).
- Логирование и мониторинг.

---

## **Архитектура**

### **Сущности (Entities)**

- `AccountTransfer` – перевод по номеру счета.
- `CardTransfer` – перевод по номеру карты.
- `PhoneTransfer` – перевод по номеру телефона.
- `Audit` – лог изменений операций.

### **DTO (Data Transfer Objects)**

- `AccountTransferDto` – DTO для перевода по счету.
- `CardTransferDto` – DTO для перевода по карте.
- `PhoneTransferDto` – DTO для перевода по телефону.
- `AuditDto` – DTO для получения истории операций.

### **Репозитории (Repositories)**

- `AccountTransferRepository` – управление переводами по счету.
- `CardTransferRepository` – управление переводами по карте.
- `PhoneTransferRepository` – управление переводами по телефону.
- `AuditRepository` – управление историей операций.

### **Сервисный слой (Services)**

- `TransferService` – интерфейс бизнес-логики переводов.
- `TransferServiceImpl` – реализация бизнес-логики.
- `AuditService` – интерфейс для получения истории операций.
- `AuditServiceImpl` – реализация получения данных аудита.

### **AOP для аудита**

- `AuditAspect` – аспект, автоматически записывающий изменения в `audit`-таблицу.

### **Контроллеры (Controllers)**

- `TransferController` – отвечает за API для переводов.

---

## **Основные API-сценарии**

### **1. Перевод по номеру счета**

- **POST** `/transfer/account`
- **Аудит:** Запись фиксируется автоматически.

### **2. Перевод по номеру карты**

- **POST** `/transfer/card`
- **Аудит:** Запись фиксируется автоматически.

### **3. Перевод по номеру телефона**

- **POST** `/transfer/phone`
- **Аудит:** Запись фиксируется автоматически.

---

## **Технологический стек**

- Java 17
- Spring Boot 3.x
- Spring Data JPA
- PostgreSQL
- Lombok
- MapStruct
- Spring Security (JWT)
- Swagger/OpenAPI
- Logback (Slf4j)
- AOP (Aspect-Oriented Programming)

---

## **Обработка ошибок (Exception Handling)**

- `GlobalExceptionHandler` – глобальный обработчик исключений.
- Обрабатывает:
    - `EntityNotFoundException`
    - `ValidationException`
    - `IllegalArgumentException`
    - `DataIntegrityViolationException`
- Возвращает структурированные ошибки.

---

## **Безопасность**

- API защищено JWT-аутентификацией.
- Логируются все действия пользователей.

---

## **Логирование и мониторинг**

- Используется `Slf4j` для логирования операций.
- Логируются:
    - Успешные операции.
    - Ошибки.
    - Доступ пользователей.
- Поддержка Prometheus/Grafana.

---

## **Развертывание**

- Контейнеризация через Docker.
- Kubernetes (Helm Charts).
- Конфигурация через `application.yml`.

---

## **Дополнительные требования**

- Код соответствует принципам **SOLID**.
- Использование **Enum** для типов операций.
- Покрытие кода unit- и интеграционными тестами.
- Готовность к **CI/CD (GitLab CI/GitHub Actions)**.

---

